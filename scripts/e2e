#!/usr/bin/env bash
ID="$(echo ${TEST_RUN_ID:-`date +%s` } | tr '[:upper:]' '[:lower:]' | tr ' ' '-')"
echo "$ID"

SPEC_ARG=""

# check if script invoke contains any argument. If so, add spec to run
if [ $# -eq 1 ]; then
  echo "Running e2e tests with spec: $1"
  SPEC_ARG="--spec ${1}"
fi

# Define the command to use (cy2 or cypress)
if [ "${TEST_DISABLE_DASHBOARD}" = "true" ] || [ "${TEST_DISABLE_DASHBOARD_LABEL}" = "true" ]; then
  echo "Running Cypress without dashboard"
  CYPRESS_COMMAND="cypress"
else
  echo "Running Cypress with Sorry Cypress on dashboard"
  CYPRESS_COMMAND="cy2"
fi

# Construct the full command
E2E_COMMAND="CYPRESS_API_URL='http://139.59.134.103:1234' ${CYPRESS_COMMAND} run ${SPEC_ARG} --ci-build-id \"$ID\" --record --key rancher-dashboard --group \"$GREP_TAGS\" --browser chrome --record --key rancher-dashboard --parallel"

# Execute the command
eval $E2E_COMMAND
