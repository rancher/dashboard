import { Canvas, Meta } from "@storybook/addon-docs";
import * as FormInput from './FormInput.stories';
import * as FormNested from './FormNested.stories';
import * as FormComponent from './FormComponent.stories';
import * as FormMarkup from './FormMarkup.stories';

<Meta title="Foundation/Form Validation"  />

# Form Validation

Form validation based on the library [`vee-validate`](https://vee-validate.logaretm.com/v4/guide/overview/) for documentation.

## Components

VeeValidate provides components ready to use as wrapper for the inputs. Read [official documentation](https://vee-validate.logaretm.com/v4/guide/components/validation/) for further details.

NOTE: If not slot is defined, a default input field text is instead adopted.

### Basic use case

To integrate with our existing components, you just need to wrap it around the `Field` component. Here an example using LabeledInput:

<Canvas of={FormMarkup.Default} />

```html
<Form>
  <Field
    name="field"
    value=""
    :rules="(value) => value && value.trim() ? true : 'This is required'"
    v-slot="{ field, meta }"
  >
    <LabeledInput
      name="field"
      v-bind="field"
      :subLabel="meta.errors.join(', ')"
      :status="!!meta.errors.length ? 'error' : meta.touched ? 'success' : undefined"
      :tooltipKey="!!meta.errors.length ? meta.errors.join(', ') : meta.touched ? 'Input correct' : undefined"
    />
  </Field>
</Form>
```

## Declared form (Composition API)

Form can be defined within the setup (also using Options API) using the [Composition API](https://vee-validate.logaretm.com/v4/guide/composition-api/getting-started/) we will have to define everything in the setup, e.g.:

### Inline defined rules

Example of configuration with custom defined rules a during declaration:

```ts
import { useForm } from 'vee-validate';

setup() {
  const { errors: errVal, values, meta } = useForm({
    validationSchema: { name: (val: string) => val !== '' ? true : 'Field is required' },
    initialValues:    { name: '' },
  });
  const [name] = defineField('name');

  return {
    name,
    values,
    errVal,
    meta,
  };
},
```

### Custom rules

Example of configuration using existing rules:

```ts
import formRulesGenerator from '@shell/utils/validators/formRules/index';
import { useForm } from 'vee-validate';

setup() {
  const store = useStore();
  const { t } = useI18n(store);
  const validators = (key: string) => formRulesGenerator(t, { key });
  const {
    errors: errVal, values, meta, defineField
  } = useForm({
    validationSchema: { name: (val: string) => validators('name').required(val) ?? true },
    initialValues:    { name: '' },
  });
  const [name] = defineField('name');

  return {
    name,
    values,
    errVal,
    meta,
    args
  };
},
```

### Rules with Yup

Example of configuration using [`yup`](https://github.com/jquense/yup):

```ts
import * as yup from 'yup';
import { useForm } from 'vee-validate';

setup() {
  const { errors: errVal, values, meta } = useForm({
    validationSchema: { name: yup.string().required().label('Container name') },
    initialValues:    { name: '' },
  });
  const [name] = defineField('name');

  return {
    name,
    values,
    errVal,
    meta,
  };
},
```

### Custom rules with Yup

```ts
import * as yup from 'yup';
import { useForm } from 'vee-validate';

setup() {
  const store = useStore();
  const { t } = useI18n(store);
  const validators = (key: string) => formRulesGenerator(t, { key });
  const { errors: errVal, values, meta } = useForm({
    validationSchema: { name: yup.string().test({
      name:    'required',
      message: () => message,
      test:    (val) => {
        message = validators('Container name').required(val);

        return !message;
      }
    })
  })
    initialValues:    { name: '' },
  });
  const [name] = defineField('name');

  return {
    name,
    values,
    errVal,
    meta,
  };
},
```

### Input

Case of input with validation based on [input component](/docs/stories-form-input--docs) and [existing rules](https://github.com/rancher/dashboard/blob/master/shell/utils/validators/formRules/index.ts).

<Canvas of={FormInput.Default} />

### Nested Form 

Form validation with nested cases as in Workloads using [Tabs](/docs/stories-components-tab--docs) and [`yup`](https://github.com/jquense/yup) validation library and custom validation inside Yup.

NOTE: A method to integrate custom validations without Yup library [is not defined and not clear](https://github.com/logaretm/vee-validate/discussions).

<Canvas of={FormNested.Default} />

### Form with custom Component

In this case using [ArrayList](https://rancher.github.io/storybook/?path=/docs/stories-components-arraylist--docs) component, the terms 'openid', 'profile' and 'email' are required.

<Canvas of={FormComponent.Default} />

